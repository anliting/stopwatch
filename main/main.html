<!doctype html>
<meta charset=utf-8>
<title>Stopwatch</title>
<body>
<script type=module>
import doe from'../lib/doe/main/doe.mjs'
let div_clock
doe.head(doe.style(`
    .stopwatch{
        text-align:center;
    }
    .stopwatch>*{
        display:inline-block;
        text-align:left;
    }
    .stopwatch>*>.clock{
        font-size:64px;
    }
`))
doe.body(
    doe.div(
        {className:'stopwatch'},
        doe.div(
            div_clock=doe.div(
                {className:'clock'},
            ),
            doe.p('Space: Start or pause.'),
            doe.p('R: Reset.'),
        )
    )
)
let
    isRunning,
    startTime,
    stopTime,
    requestId
onkeydown=e=>{
    if(e.keyCode===32){ // space
        if(!isRunning){
            if(!startTime)
                startTime=performance.now()
            else
                startTime=performance.now()-(stopTime-startTime)
            isRunning=1
            let frame=a=>{
                updateClock()
                requestId=requestAnimationFrame(frame)
            }
            requestId=requestAnimationFrame(frame)
            return
        }
        cancelAnimationFrame(requestId)
        isRunning=0
        stopTime=performance.now()
        div_clock.textContent=
            msToString(~~(performance.now()-startTime))
    }
    if(e.keyCode===82){ // r
        if(isRunning){
            cancelAnimationFrame(requestId)
            isRunning=0
        }
        startTime=undefined
        div_clock.textContent=msToString(0)
    }
}
div_clock.textContent=msToString(0)
function updateClock(){
    if(!startTime)
        return div_clock.textContent=msToString(0)
    if(!isRunning)
        return
    div_clock.textContent=
        msToString(~~(performance.now()-startTime))
}
function msToString(t){
    let output=paddingZerosTo(t%1000,3)
    t=~~(t/1000)
    output=paddingZerosTo(t%60,2)+'.'+output
    t=~~(t/60)
    output=paddingZerosTo(t%60,2)+':'+output
    t=~~(t/60)
    output=paddingZerosTo(t%24,2)+':'+output
    t=~~(t/24)
    return output
    function paddingZerosTo(m,n){
        m=''+m
        while(m.length<n)
            m='0'+m
        return m
    }
}
</script>
